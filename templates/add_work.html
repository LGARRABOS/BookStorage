{% extends "base.html" %}
{% block title %}Ajouter une œuvre{% endblock %}
{% block custom_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/add_work.css') }}">
{% endblock %}
{% block content %}
<section class="page-section">
  <header class="section-header">
    <h1>Ajouter une œuvre</h1>
    <p>Complétez les informations ci-dessous pour enrichir votre bibliothèque personnelle. Les champs peuvent être modifiés à tout moment depuis le tableau de bord.</p>
  </header>

  <form method="POST" enctype="multipart/form-data" class="form-layout card">
    <div class="form-grid">
      <div class="form-field form-field--wide">
        <label for="title">Titre</label>
        <div class="metadata-input-group">
          <input id="title" type="text" name="title" maxlength="60" required>
          <button type="button" id="metadata-search" class="btn btn-outline">Rechercher des infos</button>
        </div>
        <p class="field-hint">Renseignez un titre ou un ISBN puis lancez la recherche pour préremplir les autres champs.</p>
      </div>

      <div class="form-field">
        <label for="chapter">Chapitre actuel</label>
        <input id="chapter" type="number" name="chapter" min="0" value="0">
      </div>

      <div class="form-field">
        <label for="status">Statut de lecture</label>
        <select id="status" name="status">
          <option value="En cours">En cours</option>
          <option value="Terminé">Terminé</option>
          <option value="En pause">En pause</option>
          <option value="Abandonné">Abandonné</option>
          <option value="À lire">À lire</option>
        </select>
      </div>

      <div class="form-field">
        <label for="reading_type">Type de lecture</label>
        <select id="reading_type" name="reading_type" required>
          {% for reading_type in reading_types %}
          <option value="{{ reading_type }}">{{ reading_type }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-field">
        <label for="link">Lien vers la ressource</label>
        <input id="link" type="url" name="link" placeholder="https://...">
      </div>

      <div class="form-field">
        <label for="image">Image de couverture</label>
        <input id="image" type="file" name="image" accept="image/*">
        <p class="field-hint">Formats conseillés : JPG ou PNG (taille max. 2&nbsp;Mo).</p>
      </div>
    </div>

    <div class="form-actions">
      <a class="btn btn-secondary" href="{{ url_for('dashboard') }}">Annuler</a>
      <button type="submit" class="btn btn-primary">Ajouter à ma bibliothèque</button>
    </div>
    <input type="hidden" id="metadata_cover_url" name="metadata_cover_url">
    <input type="hidden" id="metadata_info_url" name="metadata_info_url">
  </form>

  <section id="metadata-results" class="metadata-results" hidden>
    <header>
      <h2>Suggestions d'œuvres</h2>
      <p id="metadata-status" class="field-hint">Sélectionnez une proposition pour remplir le formulaire automatiquement.</p>
    </header>
    <div id="metadata-results-list" class="metadata-results-list" role="list"></div>
  </section>
</section>

<script src="{{ url_for('static', filename='js/add_work_search.js') }}" defer></script>
{% endblock %}
