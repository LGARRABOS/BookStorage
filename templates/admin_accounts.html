{% extends "base.html" %}
{% block title %}Administration - Comptes Utilisateurs{% endblock %}
{% block custom_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}
{% block content %}
<section class="page-section">
  <header class="section-header">
    <h1>Gestion des comptes</h1>
    <p>Validez les inscriptions, attribuez les droits administrateur et supprimez les comptes inactifs pour garder l'espace de lecture sécurisé.</p>
  </header>

  <div class="table-wrapper admin-table">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Nom d'utilisateur</th>
          <th>Validé</th>
          <th>Admin</th>
          <th>Super-admin</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% set viewer_is_superadmin = session.get('is_superadmin') %}
        {% set viewer_id = session.get('user_id') %}
        {% for user in users %}
        <tr>
          <td><span class="badge info">#{{ user.id }}</span></td>
          <td>
            <div class="user-cell">
              <strong>{{ user.username }}</strong>
              {% if user.id == viewer_id %}
                <span class="badge owner">Vous</span>
              {% endif %}
            </div>
          </td>
          <td>
            <span class="badge {{ 'success' if user.validated else 'warning' }}">{{ "Oui" if user.validated else "Non" }}</span>
          </td>
          <td>
            <span class="badge {{ 'success' if user.is_admin else 'warning' }}">{{ "Oui" if user.is_admin else "Non" }}</span>
          </td>
          <td>
            <span class="badge {{ 'success' if user.is_superadmin else 'warning' }}">{{ "Oui" if user.is_superadmin else "Non" }}</span>
          </td>
          <td class="actions">
            <div class="action-items">
              {% if not user.validated %}
                <a class="btn btn-icon accent" href="{{ url_for('approve_account', user_id=user.id) }}">Approuver</a>
              {% endif %}

              {% if not user.is_admin %}
                <a class="btn btn-icon neutral" href="{{ url_for('promote_account', user_id=user.id) }}">Promouvoir</a>
                <a class="btn btn-icon danger" href="{{ url_for('delete_account', user_id=user.id) }}" onclick="return confirm('Supprimer cet utilisateur ?');">Supprimer</a>
              {% else %}
                {% if user.is_superadmin %}
                  <span class="no-action" title="Super-admin protégé">—</span>
                {% elif viewer_is_superadmin and user.id != viewer_id %}
                  <a class="btn btn-icon danger" href="{{ url_for('delete_account', user_id=user.id) }}" onclick="return confirm('Supprimer cet utilisateur ?');">Supprimer</a>
                {% elif user.id == viewer_id %}
                  <span class="no-action" title="Action indisponible sur votre propre compte">—</span>
                {% else %}
                  <span class="restricted" title="Action réservée au super-admin">Super-admin requis</span>
                {% endif %}
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
